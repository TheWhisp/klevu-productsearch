<?xml version="1.0"?>
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">

    <type name="Magento\Config\Block\System\Config\Form\Field">
        <plugin name="Klevu_Search::AdminFormFieldHideLabels"
                type="Klevu\Search\Plugin\Admin\System\Config\Form\Field\HideLabelForSingleStoreModePlugin"
                sortOrder="10"/>
        <plugin name="Klevu_Search::AdminFormFieldAddSubscriptionMessageToComment"
                type="Klevu\Search\Plugin\Admin\System\Config\Form\Field\AddSubscriptionMessagePlugin"
                sortOrder="20"/>
        <plugin name="Klevu_Search::AdminFormFieldDisableFieldsIfNotEnabled"
                type="Klevu\Search\Plugin\Admin\System\Config\Form\Field\DisableFieldPlugin"
                sortOrder="30"/>
    </type>
    <type name="Magento\Config\Model\Config">
        <plugin name="Klevu_Search::UpdateApiEndpointsOnApiKeyChange"
                type="Klevu\Search\Plugin\Model\Config\UpdateApiEndpointsOnApiKeyChange"
                sortOrder="1"/>
    </type>

    <type name="Magento\Catalog\Controller\Adminhtml\Product\Action\Attribute\Save">
        <plugin name="KlevuSearch::BulkProductSavePlugin"
                type="Klevu\Search\Plugin\Admin\BulkProductAttributeSavePlugin"
                sortOrder="1"/>
    </type>

    <type name="Magento\UrlRewrite\Controller\Adminhtml\Url\Rewrite\Save">
        <plugin name="KlevuSearch::URLRewriteSavePlugin"
                type="Klevu\Search\Plugin\Admin\UrlRewriteSavePlugin"
                sortOrder="1"/>
    </type>

    <type name="Klevu\Search\Plugin\Admin\System\Config\Form\Field\HideLabelForSingleStoreModePlugin">
        <arguments>
            <argument name="labelsToHide" xsi:type="array">
                <item name="klevu_search_attributes_info_attribute" xsi:type="string"><![CDATA[klevu_search_attributes_info_attribute]]></item>
                <item name="klevu_search_secureurl_setting_info_enabled" xsi:type="string"><![CDATA[klevu_search_secureurl_setting_info_enabled]]></item>
                <item name="klevu_search_image_setting_info_enabled" xsi:type="string"><![CDATA[klevu_search_image_setting_info_enabled]]></item>
            </argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Plugin\Admin\System\Config\Form\Field\DisableFieldPlugin">
        <arguments>
            <argument name="fieldsToDisable" xsi:type="array">
                <item name="klevu_search_attributes_boosting" xsi:type="const">Klevu\Search\Service\Account\Model\AccountFeatures::PM_FEATUREFLAG_BOOSTING</item>
                <item name="klevu_search_searchlanding_landenabled" xsi:type="const">Klevu\Search\Service\Account\Model\AccountFeatures::PM_FEATUREFLAG_PRESERVES_LAYOUT</item>
                <item name="klevu_integration_next_steps_landenabled" xsi:type="const">Klevu\Search\Service\Account\Model\AccountFeatures::PM_FEATUREFLAG_PRESERVES_LAYOUT</item>
            </argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Plugin\Admin\System\Config\Form\Field\AddSubscriptionMessagePlugin">
        <arguments>
            <argument name="fieldsToShowMessageFor" xsi:type="array">
                <item name="klevu_search_searchlanding_landenabled" xsi:type="const">Klevu\Search\Service\Account\Model\AccountFeatures::PM_FEATUREFLAG_PRESERVES_LAYOUT</item>
            </argument>
        </arguments>
    </type>

    <type name="Magento\Framework\Notification\MessageList">
        <arguments>
            <argument name="messages" xsi:type="array">
                <item name="klevu_lock_file" xsi:type="string">Klevu\Search\Model\Message\LockFileMessage</item>
                <item name="klevu_object_vs_collection" xsi:type="string">Klevu\Search\Model\Message\ObjectVsCollectionMessage</item>
                <item name="klevu_same_ip_orders" xsi:type="string">Klevu\Search\Model\Message\OrdersWithSameIPMessage</item>
            </argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Block\Adminhtml\Form\Field\ProductListSortOrder\SortOrderCodeColumn">
        <arguments>
            <argument name="productListSortOrdersSource" xsi:type="object">Klevu\Search\Model\Source\ProductListSortOrders</argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Block\Adminhtml\Form\Field\ProductListSortOrder">
        <arguments>
            <argument name="serializer" xsi:type="object">Klevu\Search\Serializer\Json</argument>
        </arguments>
    </type>

    <!-- Stores Config Log Action Buttons -->
    <type name="Klevu\Search\Block\Adminhtml\Form\Field\Logdownload">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\Search</argument>
            <argument name="destinationUrl" xsi:type="string"><![CDATA[klevu_search/download/logdownload]]></argument>
            <argument name="buttonLabel" xsi:type="string"><![CDATA[Download Klevu Search Log]]></argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Block\Adminhtml\Form\Field\Logclear">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\Search</argument>
            <argument name="destinationUrl" xsi:type="string"><![CDATA[klevu_search/download/logclear]]></argument>
            <argument name="buttonLabel" xsi:type="string"><![CDATA[Rename Klevu Search Log]]></argument>
        </arguments>
    </type>

    <virtualType name="Klevu\Search\Block\Adminhtml\Form\Field\Logdownload\PreserveLayout" type="Klevu\Logger\Block\Adminhtml\Form\Button\LogDownloadButton">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\PreserveLayout</argument>
            <argument name="destinationUrl" xsi:type="string"><![CDATA[klevu_search/download_preserveLayout/logdownload]]></argument>
            <argument name="buttonLabel" xsi:type="string"><![CDATA[Download Preserve Layout Log]]></argument>
        </arguments>
    </virtualType>

    <virtualType name="Klevu\Search\Block\Adminhtml\Form\Field\Logclear\PreserveLayout" type="Klevu\Logger\Block\Adminhtml\Form\Button\LogClearButton">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\PreserveLayout</argument>
            <argument name="destinationUrl" xsi:type="string"><![CDATA[klevu_search/download_preserveLayout/logclear]]></argument>
            <argument name="buttonLabel" xsi:type="string"><![CDATA[Rename Preserve Layout Log]]></argument>
        </arguments>
    </virtualType>

    <!-- Controllers -->
    <type name="Klevu\Search\Controller\Adminhtml\Download\Logclear">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\Search</argument>
            <argument name="logger" xsi:type="object">Klevu\Search\Logger\Logger\Search</argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Controller\Adminhtml\Download\Logdownload">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\Search</argument>
            <argument name="logger" xsi:type="object">Klevu\Search\Logger\Logger\Search</argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Controller\Adminhtml\Download\PreserveLayout\Logclear">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\PreserveLayout</argument>
            <argument name="logger" xsi:type="object">Klevu\Search\Logger\Logger\PreserveLayout</argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Controller\Adminhtml\Download\PreserveLayout\Logdownload">
        <arguments>
            <argument name="logFileNameProvider" xsi:type="object">Klevu\Search\Service\LogFileNameProvider\PreserveLayout</argument>
            <argument name="logger" xsi:type="object">Klevu\Search\Logger\Logger\PreserveLayout</argument>
            <argument name="archiveService" xsi:type="object">Magento\Framework\Archive\Zip</argument>
        </arguments>
    </type>

    <type name="Klevu\Search\Model\Order\OrdersWithSameIPCollection">
        <arguments>
            <argument name="logger" xsi:type="object">Klevu\Search\Logger\Logger\Search</argument>
        </arguments>
    </type>
</config>
